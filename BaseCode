% This program reads and processes VIMS oculus files 
% from a user-specified folder and saves corresponding output 
% files to another user-specified folder.
% Author Ethan Labianca-Campbell

% Following command makes the text window appear commanding the user
CreateStruct.Interpreter = 'tex';
CreateStruct.WindowStyle = 'modal';
msgbox('\fontsize{18} Select an input folder to read files, then select an output folder to put scanned files into.', CreateStruct)           

% Prompt user to choose a folder and return the path that the user selects
% Note we can change the start directory to any path, not just C:\
inputDirectory = uigetdir('C:\', 'Select a folder containing files to process.');

% Prompt user to choose a folder for saving data to and return the path
% Again, we can change the start directory to any path
outputDirectory = uigetdir('C:\', 'Select a folder for the output data.');

% Dir lists only *.txt files in the selected directory in a structured array
% Fullfile returns a vector with information about each file (name, folder, date, etc)
fileList = dir(fullfile(inputDirectory, '*.csv'));

% Now that you have a list of file names and folder paths, you can process each one.
for x = 1:length (fileList)

     filename = fullfile(fileList(x).folder, fileList(x).name);
     fprintf(1, 'Now reading %s\n', filename);
     fileID = fopen(filename,'r');
     dataArray = textscan(fileID,'%s%s%s%s%s%s%s%s%s%s%s%s%s%f%f%f%s','Delimiter',',','HeaderLines',1,'CollectOutput',true);
     fclose(fileID);
     
     % fullTable = table(dataArray{1:end});

     % Remove NaN rows with ~all(Arrayname, 1 or 2), where ~ means not, and 1 works by columns, 2 works by rows
     idx = ~all(isnan(dataArray{2}),2);
     junk = dataArray{1}(idx,:);
     TIMEandVIMS = dataArray{2}(idx,:);
     %ISwait = dataArray{3}(idx,:);
 
     %combined TIMEandVIMS and ISwait into a structured array called "UsefulData"
     %structuredArray.TIMEandVIMS  = TIMEandVIMS (:,:);
     %structuredArray.ISwait  = ISwait (:,:);
     %UsefulData = struct2table(structuredArray)
	
     %looping through UsefulData to get one data point every 30 seconds/(91st row)
     DataEvery30s = TIMEandVIMS(1:91:end,:);

     %separates dependant/independant variables for graphing
     TIMEEvery30s =  DataEvery30s(:,1);
     VIMSEvery30s =  DataEvery30s(:,2);
	
     %plots data and adjusts axes
     hold on
     plot(TIMEEvery30s ,VIMSEvery30s);
     scatter(TIMEEvery30s ,VIMSEvery30s,'filled', 'b');
     ylim([0 4])
     yticks([0 1 2 3 4])
     xticks([30 60 90 120 150 180 210 240 270 300 330 360])
     xlabel("Time (Seconds)")
     ylabel("VIMS rating")
     title("Temporal VIMS rating")
end
